<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Agenda Madrid">
    <meta name="theme-color" content="#37352f">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <title>Agenda Cultural Madrid</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f7f6f3;
            --text-primary: #37352f;
            --text-secondary: #787774;
            --border-color: #e9e9e7;
            --border-hover: #d3d1cb;
            --accent-color: #37352f;
            --card-bg: #ffffff;
        }
        
        [data-theme="dark"] {
            --bg-primary: #191919;
            --bg-secondary: #2f2f2f;
            --text-primary: #e3e2e0;
            --text-secondary: #9b9a97;
            --border-color: #373737;
            --border-hover: #4a4a4a;
            --accent-color: #e3e2e0;
            --card-bg: #252525;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 40px 20px;
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }
        
        .container { max-width: 800px; margin: 0 auto; }
        
        header { 
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: start;
        }
        
        .header-left h1 { 
            font-size: 32px; 
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 24px;
        }
        
        .theme-toggle {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .theme-toggle:hover {
            background: var(--bg-secondary);
        }
        
        .view-toggle { 
            display: flex; 
            gap: 8px; 
            margin-bottom: 32px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0;
        }
        
        .view-btn { 
            padding: 8px 12px;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .view-btn.active { 
            color: var(--text-primary);
            border-bottom-color: var(--accent-color);
        }
        
        .view-btn:hover { color: var(--text-primary); }
        
        .search-box {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 16px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: all 0.2s;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .filters, .categories {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .filters::-webkit-scrollbar, .categories::-webkit-scrollbar { display: none; }
        
        .filter-btn, .cat-btn {
            padding: 6px 12px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.15s;
            white-space: nowrap;
        }
        
        .filter-btn.active, .cat-btn.active {
            background: var(--accent-color);
            color: var(--bg-primary);
            border-color: var(--accent-color);
        }
        
        .filter-btn:hover, .cat-btn:hover { 
            background: var(--bg-secondary); 
        }
        
        .filter-btn.active:hover, .cat-btn.active:hover {
            background: var(--accent-color);
            opacity: 0.9;
        }
        
        .events-list, .exhibitions-list { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }
        
        .event-card, .expo-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            transition: all 0.2s;
            position: relative;
        }
        
        .event-card:hover, .expo-card:hover {
            border-color: var(--border-hover);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }
        
        .event-title, .expo-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
            padding-right: 100px;
        }
        
        .event-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .event-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        
        .event-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        
        .event-btn {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.15s;
        }
        
        .event-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--border-hover);
        }
        
        .event-btn.active {
            background: var(--accent-color);
            color: var(--bg-primary);
            border-color: var(--accent-color);
        }
        
        .badge {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 5px 12px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .badge.puntual {
            background: #f7f6f3;
            color: #787774;
        }
        
        .badge.exposicion {
            background: #f3e8ff;
            color: #7c3aed;
        }
        
        [data-theme="dark"] .badge.puntual {
            background: #373737;
            color: #9b9a97;
        }
        
        [data-theme="dark"] .badge.exposicion {
            background: #3730a3;
            color: #c4b5fd;
        }
        
        .event-category-tag {
            display: inline-block;
            padding: 3px 8px;
            background: #37352f;
            color: #ffffff;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            margin-right: 12px;
        }
        
        [data-theme="dark"] .event-category-tag {
            background: #e3e2e0;
            color: #191919;
        }
        
        .badge.today {
            background: #ffe3e3;
            color: #eb5757;
        }
        
        [data-theme="dark"] .badge.today {
            background: #4a1f1f;
            color: #ff6b6b;
        }
        
        .hidden { display: none; }
        
        .map-container {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .map-iframe {
            width: 100%;
            height: 500px;
            border: none;
            border-radius: 4px;
        }
        
        .map-info {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        
        .map-info p {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .map-info a {
            color: var(--accent-color);
            font-weight: 600;
            text-decoration: none;
        }
        
        .calendar-view {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .calendar-header h2 {
            font-size: 20px;
            color: var(--text-primary);
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background: var(--accent-color);
            color: var(--bg-primary);
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 8px;
        }
        
        .calendar-day {
            background: var(--bg-secondary);
            border-radius: 4px;
            padding: 8px;
            min-height: 60px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }
        
        .calendar-day:hover {
            background: var(--card-bg);
            border-color: var(--border-color);
        }
        
        .calendar-day.other-month {
            opacity: 0.3;
        }
        
        .calendar-day.has-events {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-color);
        }
        
        .calendar-day-number {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }
        
        .calendar-event-dot {
            width: 6px;
            height: 6px;
            background: var(--accent-color);
            border-radius: 50%;
            display: inline-block;
            margin: 2px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal.active { display: flex; }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 0;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .modal-header h3 {
            font-size: 20px;
            color: var(--text-primary);
        }
        
        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            background: none;
            border: none;
            line-height: 1;
            padding: 0;
        }
        
        .modal-close:hover {
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-event {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .modal-event:last-child {
            margin-bottom: 0;
        }
        
        .modal-event-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .modal-event-time {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .modal-event-location {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .modal-event-category {
            display: inline-block;
            padding: 2px 6px;
            background: var(--accent-color);
            color: var(--bg-primary);
            border-radius: 2px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .reminder-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .reminder-option {
            padding: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reminder-option:hover {
            background: var(--card-bg);
            border-color: var(--border-hover);
        }
        
        .reminder-option.active {
            border-color: var(--accent-color);
            background: var(--bg-secondary);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        .empty-state p {
            font-size: 16px;
            color: var(--text-secondary);
        }
        
        .expo-info {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .expo-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .cta-btn {
            display: inline-block;
            background: var(--accent-color);
            color: var(--bg-primary);
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 600;
            text-decoration: none;
            margin-top: 10px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .cta-btn:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>Agenda Cultural Madrid</h1>
                <p class="subtitle">53 eventos ¬∑ Febrero-Marzo 2026</p>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
                <span id="themeIcon">üåô</span>
            </button>
        </header>

        <div class="view-toggle">
            <button class="view-btn active" onclick="showView('agenda')">Eventos</button>
            <button class="view-btn" onclick="showView('calendar')">Calendario</button>
            <button class="view-btn" onclick="showView('favorites')">Favoritos</button>
            <button class="view-btn" onclick="showView('exposiciones')">Exposiciones</button>
            <button class="view-btn" onclick="showView('mapa')">Mapa</button>
        </div>

        <div id="agendaView">
            <input type="text" class="search-box" placeholder="Buscar eventos..." oninput="handleSearch(event)">
            <div class="filters">
                <button class="filter-btn active" onclick="setFilter('all')">Todos</button>
                <button class="filter-btn" onclick="setFilter('today')">Hoy</button>
                <button class="filter-btn" onclick="setFilter('week')">Esta semana</button>
                <button class="filter-btn" onclick="setFilter('upcoming')">Pr√≥ximos</button>
            </div>
            <div class="categories">
                <button class="cat-btn active" onclick="setCategory('all')">Todo</button>
                <button class="cat-btn" onclick="setCategory('M√∫sica')">üéµ M√∫sica</button>
                <button class="cat-btn" onclick="setCategory('Teatro')">üé≠ Teatro</button>
                <button class="cat-btn" onclick="setCategory('Cine')">üé¨ Cine</button>
                <button class="cat-btn" onclick="setCategory('Exposici√≥n')">üé® Expo</button>
                <button class="cat-btn" onclick="setCategory('Charla')">üí¨ Charla</button>
                <button class="cat-btn" onclick="setCategory('Fiesta')">üéâ Fiesta</button>
            </div>
            <div id="eventsList" class="events-list"></div>
        </div>

        <div id="calendarView" class="hidden">
            <div class="calendar-view">
                <div class="calendar-header">
                    <h2 id="calendarMonth"></h2>
                    <div class="calendar-nav">
                        <button onclick="changeMonth(-1)">‚Üê Anterior</button>
                        <button onclick="changeMonth(1)">Siguiente ‚Üí</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
        </div>

        <div id="favoritesView" class="hidden">
            <div class="expo-info">
                <p>‚≠ê Tus eventos favoritos guardados</p>
            </div>
            <div id="favoritesList" class="events-list"></div>
        </div>

        <div id="exposicionesView" class="hidden">
            <div class="expo-info">
                <p>üé® Exposiciones y muestras de larga duraci√≥n en Madrid</p>
            </div>
            <div id="exhibitionsList" class="exhibitions-list"></div>
        </div>

        <div id="mapaView" class="hidden">
            <div class="map-container">
                <iframe class="map-iframe" src="https://www.google.com/maps/d/u/0/embed?mid=10nIiJQze5J4xbDvuu-c9tMRvNeFlz9E&ehbc=2E312F" loading="lazy"></iframe>
                <div class="map-info">
                    <p>üç∑ Bares espa√±oles aut√©nticos de Madrid</p>
                    <a href="https://www.google.com/maps/d/u/0/viewer?mid=10nIiJQze5J4xbDvuu-c9tMRvNeFlz9E" target="_blank">Abrir en Google Maps ‚Üí</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚è∞ Configurar recordatorio</h3>
                <button class="modal-close" onclick="closeReminderModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="reminder-options">
                    <div class="reminder-option" onclick="setReminder(currentEventId, 1)">
                        <strong>1 d√≠a antes</strong><br>
                        <small>Te avisaremos 24h antes del evento</small>
                    </div>
                    <div class="reminder-option" onclick="setReminder(currentEventId, 2)">
                        <strong>2 d√≠as antes</strong><br>
                        <small>Te avisaremos 48h antes del evento</small>
                    </div>
                    <div class="reminder-option" onclick="setReminder(currentEventId, 7)">
                        <strong>1 semana antes</strong><br>
                        <small>Te avisaremos 7 d√≠as antes del evento</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Day Events Modal -->
    <div id="dayEventsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="dayEventsTitle">Eventos del d√≠a</h3>
                <button class="modal-close" onclick="closeDayEventsModal()">√ó</button>
            </div>
            <div class="modal-body" id="dayEventsContent">
            </div>
        </div>
    </div>

    <script>
        const EVENTS = [
            {id:'1',titulo:'Jazz en Caf√© Central',fecha:'2026-02-14',hora:'21:00',lugar:'Caf√© Central - Plaza del √Ångel',descripcion:'Concierto de jazz en vivo',categoria:'M√∫sica',url:''},
            {id:'2',titulo:'Exposici√≥n Thyssen',fecha:'2026-02-10',hora:'10:00',lugar:'Museo Thyssen',descripcion:'Arte contempor√°neo',categoria:'Exposici√≥n',url:'https://museothyssen.org'},
            {id:'3',titulo:'Cine de Terror',fecha:'2026-02-12',hora:'20:30',lugar:'Cineteca Madrid',descripcion:'Ciclo de cine de terror cl√°sico',categoria:'Cine',url:''},
            {id:'4',titulo:'La urgencia de comprender - Sesi√≥n 1',fecha:'2026-02-10',hora:'19:00',lugar:'La Casa Encendida',descripcion:'Narrativas en conflictos contempor√°neos',categoria:'Charla',url:'https://www.lacasaencendida.es'},
            {id:'5',titulo:'La urgencia de comprender - Sesi√≥n 2',fecha:'2026-02-12',hora:'19:00',lugar:'La Casa Encendida',descripcion:'Narrativas en conflictos contempor√°neos',categoria:'Charla',url:'https://www.lacasaencendida.es'},
            {id:'6',titulo:'La urgencia de comprender - Sesi√≥n 3',fecha:'2026-02-17',hora:'19:00',lugar:'La Casa Encendida',descripcion:'Narrativas en conflictos contempor√°neos',categoria:'Charla',url:'https://www.lacasaencendida.es'},
            {id:'7',titulo:'La urgencia de comprender - Sesi√≥n 4',fecha:'2026-02-19',hora:'19:00',lugar:'La Casa Encendida',descripcion:'Narrativas en conflictos contempor√°neos',categoria:'Charla',url:'https://www.lacasaencendida.es'},
            {id:'8',titulo:'La urgencia de comprender - Sesi√≥n 5',fecha:'2026-02-24',hora:'19:00',lugar:'La Casa Encendida',descripcion:'Narrativas en conflictos contempor√°neos',categoria:'Charla',url:'https://www.lacasaencendida.es'},
            {id:'9',titulo:'The Fisher King (Cinemascope 35mm)',fecha:'2026-02-22',hora:'17:30',lugar:'C. de Mira, el R√≠o Baja, 11B',descripcion:'Proyecci√≥n en formato espectacular 35mm',categoria:'Cine',url:''},
            {id:'10',titulo:'Madrid Design Festival 2026',fecha:'2026-02-05',hora:'',lugar:'Varios espacios en Madrid',descripcion:'Festival de dise√±o con 55 exposiciones y 162 actividades',categoria:'Exposici√≥n',url:'https://madriddesignfestival.lafabrica.com'},
            {id:'11',titulo:'FORMA Design Fair',fecha:'2026-03-04',hora:'',lugar:'Matadero Madrid',descripcion:'Primera feria espa√±ola de dise√±o de colecci√≥n',categoria:'Exposici√≥n',url:'https://madriddesignfestival.lafabrica.com'},
            {id:'12',titulo:'Elipa Flamenca - Actuaci√≥n 1',fecha:'2026-02-07',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito. Artistas: David de Arahal & Sandra Carrasco y m√°s',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'13',titulo:'Elipa Flamenca - Actuaci√≥n 2',fecha:'2026-02-08',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito. Artistas: Laura Reyes & Javier Pimiento y m√°s',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'14',titulo:'Elipa Flamenca - Actuaci√≥n 3',fecha:'2026-02-14',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito. Artistas: Rafael Jim√©nez El Tato y m√°s',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'15',titulo:'Elipa Flamenca - Actuaci√≥n 4',fecha:'2026-02-15',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito. Artistas: Eleazar Cerreduela, Jos√© Luis Mont√≥n y m√°s',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'16',titulo:'Elipa Flamenca - Actuaci√≥n 5',fecha:'2026-02-21',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito con grandes figuras del flamenco madrile√±o',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'17',titulo:'Elipa Flamenca - Actuaci√≥n 6',fecha:'2026-02-22',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'Ciclo de flamenco gratuito con grandes figuras del flamenco madrile√±o',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'18',titulo:'Elipa Flamenca - Cierre',fecha:'2026-02-28',hora:'19:00',lugar:'Centro Cultural Pr√≠ncipe de Asturias',descripcion:'√öltima actuaci√≥n del ciclo de flamenco gratuito Elipa Flamenca 2026',categoria:'M√∫sica',url:'https://zocoflamenco.com/el-zoco/elipa-flamenca-2026-del-5-al-28-de-febrero/'},
            {id:'19',titulo:'Literatura, individuo y territorio',fecha:'2026-02-09',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Con Carmen Madorr√°n e Irene Ortiz Gala',categoria:'Charla',url:'https://circulobellasartes.com'},
            {id:'20',titulo:'Sobre el porvenir de nuestras universidades',fecha:'2026-02-10',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Con Clara Ramas y Diego Garrocho',categoria:'Charla',url:'https://circulobellasartes.com'},
            {id:'21',titulo:'La Mesa Redonda: Lo crujiente',fecha:'2026-02-10',hora:'20:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Con Manuel Gare, Ana Gorostizu y Mar√≠a S√°nchez Saor√≠n',categoria:'Teatro',url:'https://circulobellasartes.com'},
            {id:'22',titulo:'D√≠a de la mujer y la ni√±a en Ciencia',fecha:'2026-02-11',hora:'10:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Mujeres que hacen ciencia',categoria:'Charla',url:'https://circulobellasartes.com'},
            {id:'23',titulo:'La Casa de las Artes. Abierta desde 1926',fecha:'2026-02-11',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Inauguraci√≥n de exposici√≥n',categoria:'Exposici√≥n',url:'https://circulobellasartes.com'},
            {id:'24',titulo:'Mois√©s P. S√°nchez: Beyond Beethoven',fecha:'2026-02-11',hora:'19:30',lugar:'C√≠rculo de Bellas Artes',descripcion:'Concierto ben√©fico',categoria:'M√∫sica',url:'https://circulobellasartes.com'},
            {id:'25',titulo:'Sobre el porvenir de nuestras universidades',fecha:'2026-02-12',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Con Rodrigo Castro y Antonio S√°nchez',categoria:'Charla',url:'https://circulobellasartes.com'},
            {id:'26',titulo:'Otros principios de autoridad',fecha:'2026-02-12',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Ciclo Maestras contempor√°neas. Con Marisa Manchado, Pilar Serrano Betored y Marta L√≥pez Vilar',categoria:'Charla',url:'https://circulobellasartes.com'},
            {id:'27',titulo:'Un Carnaval legendario',fecha:'2026-02-14',hora:'22:30',lugar:'C√≠rculo de Bellas Artes',descripcion:'Fiesta de carnaval',categoria:'Fiesta',url:'https://circulobellasartes.com'},
            {id:'28',titulo:'Konstantin Krimmel & Ammiel Bushakevitz',fecha:'2026-02-15',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'C√≠rculo de C√°mara',categoria:'M√∫sica',url:'https://circulobellasartes.com'},
            {id:'29',titulo:'La impaciencia del coraz√≥n',fecha:'2026-02-11',hora:'19:00',lugar:'Goethe-Institut Madrid, C/ Zurbar√°n 21',descripcion:'Cine Club Goethe. Pel√≠cula basada en la novela de Stefan Zweig. VO con subt√≠tulos',categoria:'Cine',url:'https://www.goethe.de/ins/es/es/ver.cfm?event_id=27202456'},
            {id:'30',titulo:'Nuevos y viejos colonialismos',fecha:'2026-02-21',hora:'12:30',lugar:'La Casa Encendida',descripcion:'Conversar, un mundo en tr√°nsito. Con Nabil Al Raee y Dani Zelko',categoria:'Charla',url:'https://www.lacasaencendida.es/ciclo/conversar-un-mundo-en-transito'},
            {id:'31',titulo:'El papel de Europa',fecha:'2026-02-21',hora:'19:30',lugar:'La Casa Encendida',descripcion:'Conversar, un mundo en tr√°nsito. Con Claudio Francavilla y √Åurea Molt√≥',categoria:'Charla',url:'https://www.lacasaencendida.es/ciclo/conversar-un-mundo-en-transito'},
            {id:'32',titulo:'La cronolog√≠a del agua',fecha:'2026-02-11',hora:'17:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Kristen Stewart',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'33',titulo:'Innisfree',fecha:'2026-02-11',hora:'19:30',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jos√© Luis Guerin',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'34',titulo:'Marty Supreme',fecha:'2026-02-11',hora:'22:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Josh Safdie',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'35',titulo:'La lucha',fecha:'2026-02-12',hora:'17:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jose Alay√≥n',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'36',titulo:'En construcci√≥n',fecha:'2026-02-12',hora:'19:30',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jos√© Luis Guerin',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'37',titulo:'La tarta del presidente',fecha:'2026-02-12',hora:'22:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Hasan Hadi',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'38',titulo:'Al final de la escapada',fecha:'2026-02-13',hora:'17:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jean-Luc Godard',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'39',titulo:'No hay otra opci√≥n',fecha:'2026-02-13',hora:'18:45',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Park Chan-wook',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'40',titulo:'Historias del buen valle',fecha:'2026-02-13',hora:'21:30',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jos√© Luis Guerin',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'41',titulo:'La tarta del presidente',fecha:'2026-02-14',hora:'17:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Hasan Hadi',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'42',titulo:'Historias del buen valle',fecha:'2026-02-14',hora:'19:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jos√© Luis Guerin',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'43',titulo:'No hay otra opci√≥n',fecha:'2026-02-14',hora:'21:30',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Park Chan-wook',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'44',titulo:'La tarta del presidente',fecha:'2026-02-15',hora:'17:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Hasan Hadi',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'45',titulo:'Historias del buen valle',fecha:'2026-02-15',hora:'19:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Jos√© Luis Guerin',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'46',titulo:'No hay otra opci√≥n',fecha:'2026-02-15',hora:'22:00',lugar:'Cine Estudio - C√≠rculo de Bellas Artes',descripcion:'De Park Chan-wook',categoria:'Cine',url:'https://www.instagram.com/cinestudiocba/'},
            {id:'47',titulo:'Sonido Futuro: ¬øQui√©n necesita una rave?',fecha:'2026-02-19',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Jornadas de m√∫sica electr√≥nica. Culturas del baile con Marta Echaves, Magui D√°vila, Ana Gorostizu y Pepe Tesoro (modera)',categoria:'M√∫sica',url:'https://circulobellasartes.com'},
            {id:'48',titulo:'Sonido Futuro: Error -9996',fecha:'2026-02-20',hora:'19:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Jornadas de m√∫sica electr√≥nica. Experiencias sonoras con Gara Hern√°ndez, Coco Moya, √Åmbar Tenorio Forn√©s y Ares Bordes (modera)',categoria:'M√∫sica',url:'https://circulobellasartes.com'},
            {id:'49',titulo:'Sonido Futuro: {Embrace ERR√òR}.code(party)',fecha:'2026-02-20',hora:'21:00',lugar:'C√≠rculo de Bellas Artes',descripcion:'Jornadas de m√∫sica electr√≥nica. Fiesta de cierre',categoria:'Fiesta',url:'https://circulobellasartes.com'},
            {id:'50',titulo:'AfroJam Madrid',fecha:'2026-02-13',hora:'21:30',lugar:'El S√≥tano Madrid',descripcion:'Jam session de m√∫sica afro. Todos los jueves 21:30-1:00. Sesi√≥n DJ 00:30-5:30',categoria:'M√∫sica',url:'https://linktr.ee/afrojammad'},
            {id:'51',titulo:'AfroJam Madrid',fecha:'2026-02-20',hora:'21:30',lugar:'El S√≥tano Madrid',descripcion:'Jam session de m√∫sica afro. Todos los jueves 21:30-1:00. Sesi√≥n DJ 00:30-5:30',categoria:'M√∫sica',url:'https://linktr.ee/afrojammad'},
            {id:'52',titulo:'AfroJam Madrid',fecha:'2026-02-27',hora:'21:30',lugar:'El S√≥tano Madrid',descripcion:'Jam session de m√∫sica afro. Todos los jueves 21:30-1:00. Sesi√≥n DJ 00:30-5:30',categoria:'M√∫sica',url:'https://linktr.ee/afrojammad'},
            {id:'53',titulo:'Cine y pol√≠tica: ¬øTel√©fono rojo? Volamos hacia Mosc√∫ (VOSE)',fecha:'2026-03-05',hora:'19:30',lugar:'Cine Embajadores R√≠o',descripcion:'Ciclo Cine y Pol√≠tica. Proyecci√≥n + coloquio con Emilio Dom√©nech y Ricardo Dudda. Film de Stanley Kubrick',categoria:'Cine',url:'https://cinesembajadores.es/pelicula/cine-y-politica-telefono-rojo-volamos-hacia-moscu-vose/'}
        ];

        const EXHIBITIONS = [
            {id:'e1',titulo:'NIke. Dise√±o en movimiento',fechaFin:'2026-04-05',lugar:'TeamLabs, Plaza San Mart√≠n 1',descripcion:'La mayor exposici√≥n jam√°s creada sobre Nike',url:'https://www.lafabrica.com'},
            {id:'e2',titulo:'Andr√© Ricard. Dise√±o en uso',fechaFin:'2026-05-03',lugar:'Fern√°n G√≥mez Centro Cultural',descripcion:'Retrospectiva de 60 a√±os del pionero del dise√±o industrial espa√±ol',url:'https://madriddesignfestival.lafabrica.com'},
            {id:'e3',titulo:'Manifiesto Mediterr√°neo',fechaFin:'2026-05-03',lugar:'Fern√°n G√≥mez Centro Cultural',descripcion:'Obras de 30+ artistas: cer√°mica, vidrio, cester√≠a, textiles',url:'https://madriddesignfestival.lafabrica.com'},
            {id:'e4',titulo:'Arte textil en Guatemala',fechaFin:'2026-05-03',lugar:'Fern√°n G√≥mez Centro Cultural',descripcion:'Huipiles, tejidos y patrimonio cultural guatemalteco',url:'https://madriddesignfestival.lafabrica.com'}
        ];

        let currentFilter = 'all';
        let currentCategory = 'all';
        let currentEventId = null;
        let searchTerm = '';
        let currentMonth = new Date();
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let reminders = JSON.parse(localStorage.getItem('reminders') || '{}');
        let theme = localStorage.getItem('theme') || 'light';

        // Initialize theme
        document.documentElement.setAttribute('data-theme', theme);
        document.getElementById('themeIcon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

        function toggleTheme() {
            theme = theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('themeIcon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', theme);
        }

        function showView(view) {
            document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            ['agendaView','calendarView','favoritesView','exposicionesView','mapaView'].forEach(v => 
                document.getElementById(v).classList.add('hidden')
            );
            
            if (view === 'agenda') {
                document.getElementById('agendaView').classList.remove('hidden');
                renderEvents();
            } else if (view === 'calendar') {
                document.getElementById('calendarView').classList.remove('hidden');
                renderCalendar();
            } else if (view === 'favorites') {
                document.getElementById('favoritesView').classList.remove('hidden');
                renderFavorites();
            } else if (view === 'exposiciones') {
                document.getElementById('exposicionesView').classList.remove('hidden');
                renderExhibitions();
            } else if (view === 'mapa') {
                document.getElementById('mapaView').classList.remove('hidden');
            }
        }

        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderEvents();
        }

        function setCategory(cat) {
            currentCategory = cat;
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            renderEvents();
        }

        function handleSearch(e) {
            searchTerm = e.target.value.toLowerCase();
            renderEvents();
        }

        function toggleFavorite(id) {
            if (favorites.includes(id)) {
                favorites = favorites.filter(f => f !== id);
            } else {
                favorites.push(id);
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            renderEvents();
            renderFavorites();
        }

        function addToCalendar(event) {
            const startDate = new Date(event.fecha + 'T' + (event.hora || '00:00'));
            const endDate = new Date(startDate.getTime() + 2*60*60*1000);
            
            const formatICSDate = d => {
                const pad = n => String(n).padStart(2, '0');
                return `${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}T${pad(d.getHours())}${pad(d.getMinutes())}00`;
            };
            
            const icsContent = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//Agenda Madrid//ES',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                'BEGIN:VEVENT',
                `DTSTART:${formatICSDate(startDate)}`,
                `DTEND:${formatICSDate(endDate)}`,
                `SUMMARY:${event.titulo}`,
                `DESCRIPTION:${event.descripcion}`,
                `LOCATION:${event.lugar}`,
                `URL:${event.url || ''}`,
                'STATUS:CONFIRMED',
                'SEQUENCE:0',
                'END:VEVENT',
                'END:VCALENDAR'
            ].join('\r\n');
            
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${event.titulo.replace(/[^a-z0-9]/gi, '_')}.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function shareEvent(event) {
            const url = `${window.location.origin}${window.location.pathname}?evento=${event.id}`;
            const text = `${event.titulo}\nüìÖ ${formatDate(event.fecha)}${event.hora ? ' ‚Ä¢ '+event.hora : ''}\nüìç ${event.lugar}\n\n${url}`;
            
            if (navigator.share) {
                navigator.share({ title: event.titulo, text: text });
            } else {
                navigator.clipboard.writeText(text);
                alert('¬°Enlace copiado! Comp√°rtelo donde quieras');
            }
        }

        function openReminderModal(id) {
            currentEventId = id;
            document.getElementById('reminderModal').classList.add('active');
        }

        function closeReminderModal() {
            document.getElementById('reminderModal').classList.remove('active');
            currentEventId = null;
        }

        function setReminder(id, days) {
            const event = EVENTS.find(e => e.id === id);
            const eventDate = new Date(event.fecha);
            const reminderDate = new Date(eventDate);
            reminderDate.setDate(reminderDate.getDate() - days);
            
            reminders[id] = { days, date: reminderDate.toISOString(), eventTitle: event.titulo };
            localStorage.setItem('reminders', JSON.stringify(reminders));
            
            if ('Notification' in window && Notification.permission === 'granted') {
                scheduleNotification(event, reminderDate);
            } else if ('Notification' in window && Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') scheduleNotification(event, reminderDate);
                });
            }
            
            closeReminderModal();
            alert(`‚úÖ Recordatorio configurado para ${days} d√≠a${days>1?'s':''} antes`);
        }

        function scheduleNotification(event, date) {
            const now = new Date();
            if (date > now) {
                setTimeout(() => {
                    new Notification('Recordatorio de evento', {
                        body: `${event.titulo} - ${formatDate(event.fecha)} ${event.hora}`,
                        icon: '/icon.png'
                    });
                }, date - now);
            }
        }

        function getDaysUntil(fecha) {
            const today = new Date();
            today.setHours(0,0,0,0);
            const [year, month, day] = fecha.split('-');
            const eventDate = new Date(year, month - 1, day);
            eventDate.setHours(0,0,0,0);
            return Math.ceil((eventDate - today) / (1000*60*60*24));
        }

        function formatDate(fecha) {
            const date = new Date(fecha);
            return date.toLocaleDateString('es-ES', {weekday:'short',day:'numeric',month:'short'});
        }

        function filterEvents() {
            let filtered = [...EVENTS];
            const today = new Date(); today.setHours(0,0,0,0);

            if (searchTerm) {
                filtered = filtered.filter(e => 
                    e.titulo.toLowerCase().includes(searchTerm) ||
                    e.descripcion.toLowerCase().includes(searchTerm) ||
                    e.lugar.toLowerCase().includes(searchTerm)
                );
            } else {
                // If no search term, exclude past events from 'all' filter
                if (currentFilter === 'all') {
                    filtered = filtered.filter(e => new Date(e.fecha) >= today);
                }
            }

            if (currentFilter === 'today') {
                filtered = filtered.filter(e => new Date(e.fecha).toDateString() === today.toDateString());
            } else if (currentFilter === 'week') {
                const weekFromNow = new Date(today);
                weekFromNow.setDate(weekFromNow.getDate() + 7);
                filtered = filtered.filter(e => {
                    const d = new Date(e.fecha);
                    return d >= today && d < weekFromNow;
                });
            } else if (currentFilter === 'upcoming') {
                filtered = filtered.filter(e => new Date(e.fecha) >= today);
            }

            if (currentCategory !== 'all') {
                filtered = filtered.filter(e => e.categoria === currentCategory);
            }

            return filtered.sort((a,b) => new Date(a.fecha) - new Date(b.fecha));
        }

        function renderEvents() {
            const filtered = filterEvents();
            const container = document.getElementById('eventsList');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No se encontraron eventos</p></div>';
                return;
            }
            
            container.innerHTML = filtered.map(e => {
                const days = getDaysUntil(e.fecha);
                const isFav = favorites.includes(e.id);
                const hasReminder = reminders[e.id];
                
                // Determine if it's an exposition (lasts multiple days)
                const isExposition = e.categoria === 'Exposici√≥n';
                const badgeClass = isExposition ? 'exposicion' : 'puntual';
                
                let badge = '';
                if (days === 0) {
                    badge = '<span class="badge today">Hoy</span>';
                } else if (days === 1) {
                    badge = '<span class="badge today">Ma√±ana</span>';
                } else if (days > 1 && days <= 7) {
                    badge = `<span class="badge ${badgeClass}">En ${days} d√≠as</span>`;
                } else if (days > 7) {
                    badge = `<span class="badge ${badgeClass}">En ${days} d√≠as</span>`;
                }

                return `
                    <div class="event-card">
                        <div class="event-header">
                            <div style="flex: 1;">
                                <div class="event-title">${e.titulo}</div>
                                <div class="event-meta">
                                    <span class="event-category-tag">${e.categoria}</span>
                                    <span>üìÖ ${formatDate(e.fecha)}${e.hora ? ' ‚Ä¢ '+e.hora : ''}</span>
                                    ${e.lugar ? `<span>üìç ${e.lugar}</span>` : ''}
                                </div>
                            </div>
                            ${badge}
                        </div>
                        ${e.descripcion ? `<div class="event-description">${e.descripcion}</div>` : ''}
                        <div class="event-actions">
                            <button class="event-btn ${isFav?'active':''}" onclick="toggleFavorite('${e.id}')">
                                ${isFav?'‚≠ê':'‚òÜ'} Favorito
                            </button>
                            <button class="event-btn" onclick='addToCalendar(${JSON.stringify(e)})'>
                                A√±adir a calendario
                            </button>
                            <button class="event-btn" onclick='shareEvent(${JSON.stringify(e)})'>
                                Compartir
                            </button>
                            <button class="event-btn ${hasReminder?'active':''}" onclick="openReminderModal('${e.id}')">
                                ${hasReminder?'üîî':'‚è∞'} Recordar
                            </button>
                        </div>
                        ${e.url ? `<div style="margin-top: 12px;"><a href="${e.url}" target="_blank" style="color: var(--accent-color); text-decoration: none; font-size: 13px; font-weight: 600;">Ver m√°s ‚Üí</a></div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderFavorites() {
            const favEvents = EVENTS.filter(e => favorites.includes(e.id)).sort((a,b) => new Date(a.fecha) - new Date(b.fecha));
            const container = document.getElementById('favoritesList');
            
            if (favEvents.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No tienes eventos favoritos.<br>Marca eventos con ‚≠ê para guardarlos aqu√≠.</p></div>';
                return;
            }

            container.innerHTML = favEvents.map(e => {
                const days = getDaysUntil(e.fecha);
                let badge = '';
                if (days === 0) badge = '<span class="badge today">Hoy</span>';
                else if (days === 1) badge = '<span class="badge today">Ma√±ana</span>';
                else if (days > 1 && days <= 7) badge = `<span class="badge">En ${days} d√≠as</span>`;

                return `
                    <div class="event-card">
                        <div class="event-header">
                            <div style="flex: 1;">
                                <div class="event-title">${e.titulo}</div>
                                <div class="event-meta">
                                    <span>üìÖ ${formatDate(e.fecha)}${e.hora ? ' ‚Ä¢ '+e.hora : ''}</span>
                                </div>
                            </div>
                            ${badge}
                        </div>
                        <div class="event-actions">
                            <button class="event-btn active" onclick="toggleFavorite('${e.id}')">‚≠ê Quitar</button>
                            <button class="event-btn" onclick='addToCalendar(${JSON.stringify(e)})'>A√±adir a calendario</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            document.getElementById('calendarMonth').textContent = 
                firstDay.toLocaleDateString('es-ES', {month:'long', year:'numeric'});
            
            const grid = document.getElementById('calendarGrid');
            let html = '';
            
            ['Dom','Lun','Mar','Mi√©','Jue','Vie','S√°b'].forEach(day => {
                html += `<div class="calendar-day-header">${day}</div>`;
            });
            
            const startPadding = firstDay.getDay();
            for (let i = startPadding - 1; i >= 0; i--) {
                const day = prevLastDay.getDate() - i;
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${day}</div></div>`;
            }
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
                const dayEvents = EVENTS.filter(e => e.fecha === dateStr);
                const hasEvents = dayEvents.length > 0;
                
                html += `<div class="calendar-day ${hasEvents?'has-events':''}" onclick='showDayEvents("${dateStr}")'>
                    <div class="calendar-day-number">${day}</div>
                    ${dayEvents.map(() => '<span class="calendar-event-dot"></span>').join('')}
                </div>`;
            }
            
            const endPadding = 6 - lastDay.getDay();
            for (let i = 1; i <= endPadding; i++) {
                html += `<div class="calendar-day other-month"><div class="calendar-day-number">${i}</div></div>`;
            }
            
            grid.innerHTML = html;
        }

        function changeMonth(delta) {
            currentMonth.setMonth(currentMonth.getMonth() + delta);
            renderCalendar();
        }

        function showDayEvents(date) {
            const dayEvents = EVENTS.filter(e => e.fecha === date);
            if (dayEvents.length === 0) return;
            
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('es-ES', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            
            document.getElementById('dayEventsTitle').textContent = 
                formattedDate.charAt(0).toUpperCase() + formattedDate.slice(1);
            
            const icons = {'M√∫sica':'üéµ','Teatro':'üé≠','Cine':'üé¨','Exposici√≥n':'üé®','Fiesta':'üéâ','Charla':'üí¨'};
            
            document.getElementById('dayEventsContent').innerHTML = dayEvents.map(e => `
                <div class="modal-event">
                    <div class="modal-event-category">${e.categoria}</div>
                    <div class="modal-event-title">${icons[e.categoria] || 'üìå'} ${e.titulo}</div>
                    ${e.hora ? `<div class="modal-event-time">üïê ${e.hora}</div>` : ''}
                    ${e.lugar ? `<div class="modal-event-location">üìç ${e.lugar}</div>` : ''}
                    ${e.descripcion ? `<div style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${e.descripcion}</div>` : ''}
                </div>
            `).join('');
            
            document.getElementById('dayEventsModal').classList.add('active');
        }
        
        function closeDayEventsModal() {
            document.getElementById('dayEventsModal').classList.remove('active');
        }
        
        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                closeReminderModal();
                closeDayEventsModal();
            }
        });

        function renderExhibitions() {
            const container = document.getElementById('exhibitionsList');
            container.innerHTML = EXHIBITIONS.map(ex => {
                const days = getDaysUntil(ex.fechaFin);
                const badge = days <= 30 
                    ? '<span class="badge today">¬°√öltimos d√≠as!</span>' 
                    : `<span class="badge exposicion">Hasta ${formatDate(ex.fechaFin)}</span>`;
                
                return `
                    <div class="event-card">
                        <div class="event-header">
                            <div style="flex: 1;">
                                <div class="event-title">${ex.titulo}</div>
                                <div class="event-meta">
                                    <span class="event-category-tag">Exposici√≥n</span>
                                    <span>üìÖ Hasta ${formatDate(ex.fechaFin)} (${days} d√≠as restantes)</span>
                                </div>
                            </div>
                            ${badge}
                        </div>
                        <div class="event-meta" style="margin-left: 0;">
                            <span>üìç ${ex.lugar}</span>
                        </div>
                        <div class="event-description">${ex.descripcion}</div>
                        ${ex.url ? `<a href="${ex.url}" target="_blank" class="cta-btn">M√°s informaci√≥n ‚Üí</a>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Check URL params for shared events
        const urlParams = new URLSearchParams(window.location.search);
        const sharedEventId = urlParams.get('evento');
        if (sharedEventId) {
            const event = EVENTS.find(e => e.id === sharedEventId);
            if (event) {
                setTimeout(() => {
                    alert(`üìÖ ${event.titulo}\n${formatDate(event.fecha)} ${event.hora}\nüìç ${event.lugar}`);
                }, 500);
            }
        }

        // Request notification permission on load
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        renderEvents();
    </script>
</body>
</html>
